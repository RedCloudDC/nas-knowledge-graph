import{s as e}from"./chunk-B5VhykKX.js";const t=new class{constructor(){this.searchIndex=new Map,this.lastQuery="",this.searchHistory=[],this.maxHistorySize=50}buildIndex(e,t){this.searchIndex.clear(),e.forEach(e=>{const t=this.extractSearchableText(e);this.searchIndex.set(`node-${e.id}`,{id:e.id,type:"node",text:t,data:e})}),t.forEach(e=>{const t=this.extractSearchableText(e);this.searchIndex.set(`edge-${e.id}`,{id:e.id,type:"edge",text:t,data:e})})}extractSearchableText(e){const t=[];return e.label&&t.push(e.label.toLowerCase()),e.type&&t.push(e.type.toLowerCase()),e.id&&t.push(String(e.id).toLowerCase()),e.properties&&Object.entries(e.properties).forEach(([e,s])=>{t.push(e.toLowerCase()),t.push(String(s).toLowerCase())}),t.join(" ")}textSearch(e,t={}){const{caseSensitive:s=!1,exactMatch:r=!1,searchNodes:i=!0,searchEdges:a=!0,limit:n=100}=t;if(!e)return[];const o=s?e:e.toLowerCase(),c=[];return this.searchIndex.forEach((e,t)=>{if(!i&&"node"===e.type)return;if(!a&&"edge"===e.type)return;let s=!1;return s=r?e.text.includes(o):this.fuzzyMatch(e.text,o),s&&c.push({...e,score:this.calculateRelevanceScore(e.text,o)}),!(c.length>=n)&&void 0}),c.sort((e,t)=>t.score-e.score),this.addToHistory(e),c}searchNodes(t={}){const{nodes:s}=e.getState();return s.filter(e=>this.matchesCriteria(e,t))}searchEdges(t={}){const{edges:s}=e.getState();return s.filter(e=>this.matchesCriteria(e,t))}findNodesByType(t){const{nodes:s}=e.getState();return s.filter(e=>e.type===t)}findConnectedNodes(t,s={}){const{maxDepth:r=1,direction:i="both"}=s,{nodes:a,edges:n}=e.getState(),o=new Set,c=[],l=[{id:t,depth:0}];for(;l.length>0;){const{id:e,depth:t}=l.shift();if(!(o.has(e)||t>r)){if(o.add(e),t>0){const t=a.find(t=>t.id===e);t&&c.push(t)}if(t<r){this.getNodeConnections(e,n,i).forEach(e=>{o.has(e)||l.push({id:e,depth:t+1})})}}}return c}findPath(t,s,r={}){const{maxDepth:i=10,weighted:a=!1}=r,{edges:n}=e.getState();if(t===s)return[t];const o=[{id:t,path:[t],depth:0}],c=new Set;for(;o.length>0;){const{id:e,path:t,depth:r}=o.shift();if(c.has(e)||r>i)continue;c.add(e);const a=this.getNodeConnections(e,n,"both");for(const i of a){if(i===s)return[...t,i];c.has(i)||o.push({id:i,path:[...t,i],depth:r+1})}}return null}advancedSearch(t={}){const{text:s="",nodeTypes:r=[],edgeTypes:i=[],properties:a={},dateRange:n=null,minConnections:o=null,maxConnections:c=null}=t;let l={nodes:[],edges:[]};if(s){const e=this.textSearch(s);l.nodes=e.filter(e=>"node"===e.type).map(e=>e.data),l.edges=e.filter(e=>"edge"===e.type).map(e=>e.data)}else{const t=e.getState();l.nodes=[...t.nodes],l.edges=[...t.edges]}if(r.length>0&&(l.nodes=l.nodes.filter(e=>r.includes(e.type))),i.length>0&&(l.edges=l.edges.filter(e=>i.includes(e.type))),Object.keys(a).length>0&&(l.nodes=l.nodes.filter(e=>this.matchesProperties(e,a)),l.edges=l.edges.filter(e=>this.matchesProperties(e,a))),null!==o||null!==c){const{edges:t}=e.getState();l.nodes=l.nodes.filter(e=>{const s=this.getNodeConnectionCount(e.id,t);return(null===o||s>=o)&&(null===c||s<=c)})}return l}getSuggestions(e,t=10){if(!e)return[];const s=e.toLowerCase(),r=new Set;return this.searchIndex.forEach(e=>{e.text.split(" ").forEach(e=>{e.startsWith(s)&&e.length>s.length&&r.add(e)})}),Array.from(r).slice(0,t)}getSearchHistory(){return[...this.searchHistory].reverse()}clearSearchHistory(){this.searchHistory=[]}matchesCriteria(e,t){for(const[s,r]of Object.entries(t))if(!this.matchesCriterion(e,s,r))return!1;return!0}matchesCriterion(e,t,s){if("text"===t){const t=this.extractSearchableText(e);return this.fuzzyMatch(t,s.toLowerCase())}return"type"===t?Array.isArray(s)?s.includes(e.type):e.type===s:"id"===t?Array.isArray(s)?s.includes(e.id):e.id===s:"properties"===t?this.matchesProperties(e,s):e[t]===s}matchesProperties(e,t){if(!e.properties)return 0===Object.keys(t).length;for(const[s,r]of Object.entries(t)){if(!e.properties.hasOwnProperty(s))return!1;const t=e.properties[s];if("object"==typeof r&&r.operator){if(!this.matchesOperator(t,r.value,r.operator))return!1}else if(t!==r)return!1}return!0}matchesOperator(e,t,s){switch(s){case"eq":default:return e===t;case"ne":return e!==t;case"gt":return e>t;case"gte":return e>=t;case"lt":return e<t;case"lte":return e<=t;case"contains":return String(e).toLowerCase().includes(String(t).toLowerCase());case"startsWith":return String(e).toLowerCase().startsWith(String(t).toLowerCase());case"endsWith":return String(e).toLowerCase().endsWith(String(t).toLowerCase());case"regex":return new RegExp(t,"i").test(String(e))}}getNodeConnections(e,t,s="both"){const r=[];return t.forEach(t=>{"both"!==s&&"out"!==s||t.source===e&&r.push(t.target),"both"!==s&&"in"!==s||t.target===e&&r.push(t.source)}),r}getNodeConnectionCount(e,t){return t.filter(t=>t.source===e||t.target===e).length}fuzzyMatch(e,t){let s=0;for(let r=0;r<e.length&&s<t.length;r++)e[r]===t[s]&&s++;return s===t.length}calculateRelevanceScore(e,t){let s=0;e.includes(t)&&(s+=100),e.startsWith(t)&&(s+=50);return e.split(" ").forEach(e=>{e.startsWith(t)&&(s+=25),e===t&&(s+=75)}),s-=.1*e.length,Math.max(0,s)}addToHistory(e){if(!e||e===this.lastQuery)return;const t=this.searchHistory.indexOf(e);t>-1&&this.searchHistory.splice(t,1),this.searchHistory.unshift(e),this.searchHistory.length>this.maxHistorySize&&(this.searchHistory=this.searchHistory.slice(0,this.maxHistorySize)),this.lastQuery=e}searchNeighborhood(e,t,s=1){const r=this.findConnectedNodes(e,{maxDepth:s});return t?r.filter(e=>{const s=this.extractSearchableText(e);return this.fuzzyMatch(s,t.toLowerCase())}):r}saveSearch(e,t){const s=this.getSavedSearches();s[e]={filters:t,created:(new Date).toISOString(),lastUsed:(new Date).toISOString()},localStorage.setItem("kg-saved-searches",JSON.stringify(s))}getSavedSearches(){try{return JSON.parse(localStorage.getItem("kg-saved-searches")||"{}")}catch{return{}}}executeSavedSearch(e){const t=this.getSavedSearches(),s=t[e];if(!s)throw new Error(`Saved search '${e}' not found`);return s.lastUsed=(new Date).toISOString(),localStorage.setItem("kg-saved-searches",JSON.stringify(t)),this.advancedSearch(s.filters)}updateIndex(){const{nodes:t,edges:s}=e.getState();this.buildIndex(t,s)}};function s(e,t){let s;return function(...r){s||(e.apply(this,r),s=!0,setTimeout(()=>{s=!1},t))}}function r(e,t,s=!1){let r;const i=function(...i){const a=s&&!r;clearTimeout(r),r=setTimeout(()=>{r=null,s||e.apply(this,i)},t),a&&e.apply(this,i)};return i.cancel=()=>{clearTimeout(r),r=null},i}function i(e){let t;return function(...s){t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{e.apply(this,s)})}}function a(e,t=100,s=10){let r,i=[];return function(a){if(i.push(a),i.length>=s){const t=i.slice();i=[],clearTimeout(r),e(t)}else clearTimeout(r),r=setTimeout(()=>{if(i.length>0){const t=i.slice();i=[],e(t)}},t)}}e.subscribe("nodes",()=>t.updateIndex()),e.subscribe("edges",()=>t.updateIndex());const n=new class{constructor(){this.activeFilters=new Map,this.filterHistory=[],this.maxHistorySize=20}applyFilters(t={}){const{nodes:s,edges:r}=e.getState();let i=[...s],a=[...r];if(t.nodes&&(i=this.filterNodes(i,t.nodes)),t.edges&&(a=this.filterEdges(a,t.edges)),!1!==t.cascadeEdges){const e=new Set(i.map(e=>e.id));a=a.filter(t=>e.has(t.source)&&e.has(t.target))}return{nodes:i,edges:a}}filterNodes(e,t){return e.filter(e=>this.nodeMatchesCriteria(e,t))}filterEdges(e,t){return e.filter(e=>this.edgeMatchesCriteria(e,t))}nodeMatchesCriteria(e,t){for(const[s,r]of Object.entries(t))if(!this.applyNodeFilter(e,s,r))return!1;return!0}edgeMatchesCriteria(e,t){for(const[s,r]of Object.entries(t))if(!this.applyEdgeFilter(e,s,r))return!1;return!0}applyNodeFilter(e,t,s){switch(t){case"type":return this.filterByType(e.type,s);case"label":return this.filterByText(e.label,s);case"id":return this.filterById(e.id,s);case"properties":return this.filterByProperties(e.properties||{},s);case"connections":return this.filterByConnectionCount(e.id,s);case"degree":return this.filterByDegree(e.id,s);case"custom":return this.filterByCustomFunction(e,s);default:return!0}}applyEdgeFilter(e,t,s){switch(t){case"type":return this.filterByType(e.type,s);case"label":return this.filterByText(e.label,s);case"id":return this.filterById(e.id,s);case"properties":return this.filterByProperties(e.properties||{},s);case"source":return this.filterById(e.source,s);case"target":return this.filterById(e.target,s);case"custom":return this.filterByCustomFunction(e,s);default:return!0}}filterByType(e,t){return Array.isArray(t)?t.includes(e):"object"==typeof t&&t.operator?this.applyOperator(e,t.value,t.operator):e===t}filterByText(e,t){if(!e)return!t;if("string"==typeof t)return e.toLowerCase().includes(t.toLowerCase());if("object"==typeof t){const{value:s,operator:r="contains",caseSensitive:i=!1}=t,a=i?e:e.toLowerCase(),n=i?s:s.toLowerCase();switch(r){case"equals":return a===n;case"contains":default:return a.includes(n);case"startsWith":return a.startsWith(n);case"endsWith":return a.endsWith(n);case"regex":return new RegExp(s,i?"g":"gi").test(e)}}return!1}filterById(e,t){return Array.isArray(t)?t.includes(e):"object"==typeof t&&t.operator?this.applyOperator(e,t.value,t.operator):e===t}filterByProperties(e,t){if("object"!=typeof t)return!1;for(const[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s))return!1;const t=e[s];if("object"==typeof r&&r.operator){if(!this.applyOperator(t,r.value,r.operator))return!1}else if(t!==r)return!1}return!0}filterByConnectionCount(t,s){const{edges:r}=e.getState(),i=r.filter(e=>e.source===t||e.target===t).length;return"number"==typeof s?i===s:"object"==typeof s&&this.applyOperator(i,s.value,s.operator)}filterByDegree(t,s){const{edges:r}=e.getState(),i=r.filter(e=>e.target===t).length,a=r.filter(e=>e.source===t).length,n=i+a,{type:o="total",operator:c="eq",value:l}=s;let h;switch(o){case"in":h=i;break;case"out":h=a;break;default:h=n}return this.applyOperator(h,l,c)}filterByCustomFunction(e,t){return"function"!=typeof t||t(e)}applyOperator(e,t,s){switch(s){case"eq":case"=":case"==":default:return e===t;case"ne":case"!=":return e!==t;case"gt":case">":return e>t;case"gte":case">=":return e>=t;case"lt":case"<":return e<t;case"lte":case"<=":return e<=t;case"in":return Array.isArray(t)&&t.includes(e);case"nin":return Array.isArray(t)&&!t.includes(e);case"between":return Array.isArray(t)&&2===t.length&&e>=t[0]&&e<=t[1];case"contains":return String(e).toLowerCase().includes(String(t).toLowerCase());case"startsWith":return String(e).toLowerCase().startsWith(String(t).toLowerCase());case"endsWith":return String(e).toLowerCase().endsWith(String(t).toLowerCase());case"regex":return new RegExp(t,"i").test(String(e))}}createFilterSet(e,t){return this.activeFilters.set(e,{config:t,created:(new Date).toISOString(),active:!0}),this.addToHistory({name:e,config:t,action:"create"}),this.applyFilters(t)}updateFilterSet(e,t){if(!this.activeFilters.has(e))throw new Error(`Filter set '${e}' not found`);return this.activeFilters.set(e,{...this.activeFilters.get(e),config:t,updated:(new Date).toISOString()}),this.addToHistory({name:e,config:t,action:"update"}),this.applyAllActiveFilters()}removeFilterSet(e){if(this.activeFilters.has(e)){const t=this.activeFilters.get(e);this.activeFilters.delete(e),this.addToHistory({name:e,config:t.config,action:"remove"})}return this.applyAllActiveFilters()}toggleFilterSet(e,t=null){if(!this.activeFilters.has(e))return null;const s=this.activeFilters.get(e),r=null!==t?t:!s.active;return this.activeFilters.set(e,{...s,active:r}),this.addToHistory({name:e,config:s.config,action:r?"activate":"deactivate"}),this.applyAllActiveFilters()}applyAllActiveFilters(){const{nodes:t,edges:s}=e.getState();let r={nodes:[...t],edges:[...s]};for(const[e,i]of this.activeFilters.entries())i.active&&(r=this.applyFilters({...i.config,nodes:r.nodes,edges:r.edges}));return r}getActiveFilters(){const e={};return this.activeFilters.forEach((t,s)=>{t.active&&(e[s]=t)}),e}getAllFilters(){const e={};return this.activeFilters.forEach((t,s)=>{e[s]=t}),e}clearAllFilters(){this.activeFilters.clear(),this.addToHistory({action:"clear_all"});const{nodes:t,edges:s}=e.getState();return{nodes:t,edges:s}}createNodeTypeFilter(e){return this.createFilterSet("nodeType",{nodes:{type:e}})}createConnectionFilter(e=0,t=null){const s={operator:"gte",value:e};return null!==t&&(s.operator="between",s.value=[e,t]),this.createFilterSet("connections",{nodes:{connections:s}})}createPropertyFilter(e,t,s="eq"){return this.createFilterSet(`property-${e}`,{nodes:{properties:{[e]:{operator:s,value:t}}}})}createTextFilter(e,t="label"){return this.createFilterSet("textSearch",{nodes:{[t]:{value:e,operator:"contains"}}})}createFilterFromSearch(e,t="searchFilter"){const s=e.nodes.map(e=>e.id),r=e.edges.map(e=>e.id);return this.createFilterSet(t,{nodes:{id:s},edges:{id:r}})}exportFilters(){const e={};return this.activeFilters.forEach((t,s)=>{e[s]={config:t.config,active:t.active,created:t.created,updated:t.updated}}),JSON.stringify(e,null,2)}importFilters(e){try{const t=JSON.parse(e);return Object.entries(t).forEach(([e,t])=>{this.activeFilters.set(e,{config:t.config,active:!1!==t.active,created:t.created||(new Date).toISOString(),updated:t.updated,imported:(new Date).toISOString()})}),this.addToHistory({action:"import",count:Object.keys(t).length}),this.applyAllActiveFilters()}catch(t){throw new Error("Invalid filter configuration JSON")}}getFilterStats(){const{nodes:t,edges:s}=e.getState(),r=this.applyAllActiveFilters();return{original:{nodes:t.length,edges:s.length},filtered:{nodes:r.nodes.length,edges:r.edges.length},reduction:{nodes:t.length-r.nodes.length,edges:s.length-r.edges.length,nodesPercent:t.length>0?(100*(1-r.nodes.length/t.length)).toFixed(1):0,edgesPercent:s.length>0?(100*(1-r.edges.length/s.length)).toFixed(1):0},activeFilters:Array.from(this.activeFilters.keys()).filter(e=>this.activeFilters.get(e).active).length}}addToHistory(e){this.filterHistory.unshift({...e,timestamp:(new Date).toISOString()}),this.filterHistory.length>this.maxHistorySize&&(this.filterHistory=this.filterHistory.slice(0,this.maxHistorySize))}getFilterHistory(){return[...this.filterHistory]}clearFilterHistory(){this.filterHistory=[]}};class o{constructor(){this.stateVersion="1.0",this.maxUrlLength=2048,this.compressionEnabled=!0,this.debounceDelay=500,this.updateTimeout=null,this.stateKeys={filters:"f",search:"s",selectedNode:"n",selectedEdge:"e",graphView:"v",sidePanel:"p",theme:"t",layout:"l",exploredNodes:"ex",pathfinding:"pf",dataSource:"d",timestamp:"ts"},this.reverseStateKeys=Object.fromEntries(Object.entries(this.stateKeys).map(([e,t])=>[t,e])),this.init()}init(){this.loadStateFromUrl(),this.setupEventListeners(),this.setupStoreSubscriptions()}setupEventListeners(){window.addEventListener("popstate",e=>{e.state&&e.state.appState?this.restoreState(e.state.appState):this.loadStateFromUrl()}),window.addEventListener("hashchange",()=>{this.loadStateFromUrl()}),document.addEventListener("filtersApplied",e=>{this.updateUrlState("filters",e.detail.filterState)}),document.addEventListener("globalSearch",e=>{this.updateUrlState("search",{query:e.detail.query,scope:e.detail.scope,timestamp:e.detail.timestamp})}),document.addEventListener("layoutChange",e=>{this.updateUrlState("layout",e.detail.layout)}),document.addEventListener("nodeSelected",e=>{this.updateUrlState("selectedNode",e.detail.nodeId)}),document.addEventListener("explorationStateChanged",e=>{this.updateUrlState("exploredNodes",Array.from(e.detail.exploredNodes))})}setupStoreSubscriptions(){e.subscribe("selectedNode",e=>{const t=e?e.id:null;this.updateUrlState("selectedNode",t)}),e.subscribe("graphView",e=>{this.updateUrlState("graphView",{zoom:e.zoom,center:e.center,layout:e.layout})}),e.subscribe("sidePanel",e=>{this.updateUrlState("sidePanel",{visible:e.visible,activeTab:e.activeTab})})}updateUrlState(e,t,s=!1){this.updateTimeout&&clearTimeout(this.updateTimeout);const r=()=>{this.setUrlState(e,t)};s?r():this.updateTimeout=setTimeout(r,this.debounceDelay)}setUrlState(e,t){try{const s=this.parseUrlHash();null==t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length?delete s[this.stateKeys[e]]:s[this.stateKeys[e]]=t,s[this.stateKeys.timestamp]=Date.now();const r=this.buildUrlHash(s);if(r.length>this.maxUrlLength){const e=this.compressState(s),t=this.buildUrlHash(e);t.length<=this.maxUrlLength&&this.setUrlHash(t)}else this.setUrlHash(r);this.pushStateToHistory(s)}catch(s){}}loadStateFromUrl(){try{const e=this.parseUrlHash(),t=this.convertToAppState(e);Object.keys(t).length>0&&this.applyStateToApp(t)}catch(e){}}parseUrlHash(){const e=window.location.hash.substring(1);if(!e)return{};try{if(e.startsWith("c:"))return this.decompressState(e.substring(2));if(this.isBase64(e)){const t=atob(e);return JSON.parse(t)}const t=new URLSearchParams(e),s={};for(const[e,r]of t.entries())try{s[e]=JSON.parse(decodeURIComponent(r))}catch{s[e]=decodeURIComponent(r)}return s}catch(t){return{}}}buildUrlHash(e){if(0===Object.keys(e).length)return"";try{const t=JSON.stringify(e),s=btoa(t);if(s.length<this.maxUrlLength)return s;const r=new URLSearchParams;for(const[i,a]of Object.entries(e))if(null!=a){const e="object"==typeof a?JSON.stringify(a):String(a);r.set(i,e)}return r.toString()}catch(t){return""}}setUrlHash(e){if(window.location.hash.substring(1)!==e){const t=e?`${window.location.pathname}#${e}`:window.location.pathname;window.history.replaceState(null,"",t)}}pushStateToHistory(e){const t=this.convertToAppState(e);window.history.replaceState({appState:t,timestamp:Date.now()},document.title,window.location.href)}convertToAppState(e){const t={};for(const[s,r]of Object.entries(e)){const e=this.reverseStateKeys[s];e&&(t[e]=r)}return t}applyStateToApp(t){t.filters&&document.dispatchEvent(new CustomEvent("applyUrlFilters",{detail:{filters:t.filters}})),t.search&&document.dispatchEvent(new CustomEvent("applyUrlSearch",{detail:t.search})),t.selectedNode&&e.setState({selectedNode:this.findNodeById(t.selectedNode)}),t.graphView&&e.setState({graphView:t.graphView}),t.sidePanel&&e.setState({sidePanel:t.sidePanel}),t.theme&&document.dispatchEvent(new CustomEvent("applyTheme",{detail:{theme:t.theme}})),t.layout&&document.dispatchEvent(new CustomEvent("applyLayout",{detail:{layout:t.layout}})),t.exploredNodes&&document.dispatchEvent(new CustomEvent("applyExplorationState",{detail:{exploredNodes:new Set(t.exploredNodes)}})),t.pathfinding&&document.dispatchEvent(new CustomEvent("applyPathfindingState",{detail:t.pathfinding}))}findNodeById(t){const{nodes:s}=e.getState();return s.find(e=>e.id.toString()===t.toString())}compressState(e){const t={},{ts:s,...r}=e;for(const[i,a]of Object.entries(r))Array.isArray(a)?a.length>0&&(t[i]=a):"object"==typeof a&&null!==a?Object.keys(a).length>0&&(t[i]=a):null!=a&&""!==a&&(t[i]=a);return t}decompressState(e){try{const t=atob(e);return JSON.parse(t)}catch(t){return{}}}isBase64(e){try{return btoa(atob(e))===e}catch{return!1}}generateShareableUrl(e={}){const{includeView:t=!0,includeFilters:s=!0,includeSearch:r=!0,includeSelection:i=!0,includeExploration:a=!1}=e,n=this.parseUrlHash(),o={};o.v=this.stateVersion,s&&n[this.stateKeys.filters]&&(o[this.stateKeys.filters]=n[this.stateKeys.filters]),r&&n[this.stateKeys.search]&&(o[this.stateKeys.search]=n[this.stateKeys.search]),i&&(n[this.stateKeys.selectedNode]&&(o[this.stateKeys.selectedNode]=n[this.stateKeys.selectedNode]),n[this.stateKeys.selectedEdge]&&(o[this.stateKeys.selectedEdge]=n[this.stateKeys.selectedEdge])),t&&(n[this.stateKeys.graphView]&&(o[this.stateKeys.graphView]=n[this.stateKeys.graphView]),n[this.stateKeys.layout]&&(o[this.stateKeys.layout]=n[this.stateKeys.layout]),n[this.stateKeys.theme]&&(o[this.stateKeys.theme]=n[this.stateKeys.theme])),a&&n[this.stateKeys.exploredNodes]&&(o[this.stateKeys.exploredNodes]=n[this.stateKeys.exploredNodes]),o[this.stateKeys.timestamp]=Date.now();const c=this.buildUrlHash(o),l=`${window.location.protocol}//${window.location.host}${window.location.pathname}`;return c?`${l}#${c}`:l}async copyShareableUrl(e={}){try{const t=this.generateShareableUrl(e);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}return document.dispatchEvent(new CustomEvent("urlCopied",{detail:{url:t,options:e}})),t}catch(t){throw t}}clearUrlState(){window.history.replaceState(null,"",window.location.pathname)}getStateSummary(){const e=this.parseUrlHash(),t=this.convertToAppState(e);return{urlHash:window.location.hash,urlState:e,appState:t,urlLength:window.location.href.length,compressed:window.location.hash.startsWith("#c:")}}validateState(e){const t=[];e.v&&e.v!==this.stateVersion&&t.push(`State version mismatch: ${e.v} vs ${this.stateVersion}`);const s=new Set(Object.values(this.stateKeys));for(const r of Object.keys(e))s.has(r)||"v"===r||t.push(`Unknown state key: ${r}`);return{valid:0===t.length,issues:t}}restoreState(e){this.validateState(e).valid,this.applyStateToApp(this.convertToAppState(e));const t=this.buildUrlHash(e);this.setUrlHash(t)}saveStateToStorage(e="app-state-backup"){try{const t=this.parseUrlHash();localStorage.setItem(e,JSON.stringify({state:t,timestamp:Date.now(),url:window.location.href}))}catch(t){}}loadStateFromStorage(e="app-state-backup"){try{const t=localStorage.getItem(e);if(!t)return null;const{state:s,timestamp:r,url:i}=JSON.parse(t);return s}catch(t){return null}}getAnalytics(){const e=this.parseUrlHash(),t=this.convertToAppState(e);return{stateKeys:Object.keys(t),urlLength:window.location.href.length,stateSize:JSON.stringify(e).length,isCompressed:window.location.hash.startsWith("#c:"),timestamp:t.timestamp,hasFilters:!!t.filters,hasSearch:!!t.search,hasSelection:!(!t.selectedNode&&!t.selectedEdge),hasView:!!t.graphView,hasExploration:!!t.exploredNodes}}destroy(){this.updateTimeout&&clearTimeout(this.updateTimeout),window.removeEventListener("popstate",this.loadStateFromUrl),window.removeEventListener("hashchange",this.loadStateFromUrl)}}export{o as U,n as a,a as b,r as c,i as f,t as s,s as t};
//# sourceMappingURL=chunk-BDh3YsLp.js.map
