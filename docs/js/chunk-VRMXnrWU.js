import{s as e}from"./chunk-B5VhykKX.js";class t{constructor(e){if(this.containerId=e,this.container=document.getElementById(e),!this.container)throw new Error(`Container with ID '${this.containerId}' not found`);this.d3=window.d3,this.d3?(this.svg=null,this.simulation=null,this.nodes=[],this.edges=[],this.hiddenNodes=new Set,this.clusteredNodes=new Map,this.nodeSelection=null,this.edgeSelection=null,this.nodeGroup=null,this.edgeGroup=null,this.selectedNodes=new Set,this.highlightedNodes=new Set,this.focusedNodeIndex=-1,this.keyboardNavigationMode=!1,this.isDragging=!1,this.transform={x:0,y:0,k:1},this.focusableNodes=[],this.nodeDescriptions=new Map,this.config={width:1e3,height:700,nodeRadius:{small:15,medium:20,large:28,cluster:35},edgeLength:{default:120,cluster:180,strong:90},nodeColors:{faa_stars_terminal:"#e74c3c",approach_control:"#3498db",faa_eram_terminal:"#2ecc71",geographic_location:"#f39c12",radar_equipment:"#9b59b6",communication_equipment:"#e67e22",default:"#95a5a6",cluster:"#34495e"},nodeIcons:{faa_stars_terminal:"üè¢",approach_control:"üõ´",faa_eram_terminal:"üì°",geographic_location:"üìç",radar_equipment:"üìä",communication_equipment:"üìª",default:"‚óâ",cluster:"‚ö™"},edgeTypes:{LOCATED_AT:{color:"#3498db",width:2.5,dash:null},CONNECTED_TO:{color:"#2ecc71",width:2,dash:null},CONTAINS:{color:"#e74c3c",width:3,dash:null},default:{color:"#bdc3c7",width:1.8,dash:null}},forces:{charge:-1200,chargeDistance:400,collide:40,centerStrength:.05,linkStrength:.8,linkDistance:120},transitions:{duration:900,stagger:50,ease:this.d3?.easeCubicInOut||"cubic-in-out"},clustering:{enabled:!0,threshold:4,maxDistance:150,minClusterSize:3},performance:{maxSimulationIterations:300,simulationCooldown:.1,renderThrottle:16,batchSize:100,enableLOD:!0,maxVisibleNodes:1e3,useOffscreen:!1,enableWebGL:!1}},this.performanceStats={frameCount:0,lastFpsUpdate:performance.now(),fps:0,renderTime:0,simulationIterations:0},this.animationFrameId=null,this.isAnimating=!1,this.pendingUpdates=new Set,this.lodNodes=new Map,this.lodEdges=new Map,this.currentZoomLevel=1,this.init(),this.setupSubscriptions(),this.setupAccessibilityFeatures()):this.loadD3().then(()=>{this.init()})}async loadD3(){return new Promise((e,t)=>{if(window.d3)return this.d3=window.d3,void e();const s=document.createElement("script");s.src="https://d3js.org/d3.v7.min.js",s.onload=()=>{this.d3=window.d3,e()},s.onerror=t,document.head.appendChild(s)})}init(){this.d3&&(this.container.innerHTML="",this.createResponsiveSVG(),this.setupZoomBehavior(),this.setupForceSimulation(),this.createDefinitions())}createResponsiveSVG(){const e=this.container.getBoundingClientRect();this.config.width=e.width||this.config.width,this.config.height=e.height||this.config.height,this.svg=this.d3.select(this.container).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${this.config.width} ${this.config.height}`).style("background","linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)").style("border-radius","8px"),this.zoomGroup=this.svg.append("g").attr("class","zoom-group"),this.edgeGroup=this.zoomGroup.append("g").attr("class","edges"),this.nodeGroup=this.zoomGroup.append("g").attr("class","nodes")}setupZoomBehavior(){this.zoom=this.d3.zoom().scaleExtent([.1,5]).on("zoom",t=>{this.transform=t.transform,this.zoomGroup.attr("transform",t.transform),e.setState({graphView:{...e.getState().graphView,zoom:t.transform.k,center:{x:-t.transform.x,y:-t.transform.y}}}),this.adjustElementsForZoom(t.transform.k)}),this.svg.call(this.zoom),this.svg.on("dblclick.zoom",()=>{this.resetView()}),this.setupGraphKeyboardNavigation()}setupForceSimulation(){this.simulation=this.d3.forceSimulation().force("link",this.d3.forceLink().id(e=>e.id).distance(e=>this.getLinkDistance(e)).strength(this.config.forces.linkStrength)).force("charge",this.d3.forceManyBody().strength(this.config.forces.charge).distanceMax(this.config.forces.chargeDistance)).force("center",this.d3.forceCenter(this.config.width/2,this.config.height/2).strength(this.config.forces.centerStrength)).force("collision",this.d3.forceCollide().radius(e=>this.getNodeRadius(e)+this.config.forces.collide).strength(.8)).force("x",this.d3.forceX(this.config.width/2).strength(.02)).force("y",this.d3.forceY(this.config.height/2).strength(.02)),this.simulation.on("tick",()=>{this.handleSimulationTick()}),this.simulation.on("end",()=>{}),this.simulationIterationCount=0}handleSimulationTick(){this.simulationIterationCount++,this.performanceStats.simulationIterations=this.simulationIterationCount,this.simulationIterationCount>this.config.performance.maxSimulationIterations||this.simulation.alpha()<this.config.performance.simulationCooldown?this.simulation.stop():this.isAnimating||(this.isAnimating=!0,this.animationFrameId=requestAnimationFrame(()=>{const e=performance.now();this.updatePositionsOptimized();const t=performance.now();this.performanceStats.renderTime=t-e,this.updateFPS(),this.isAnimating=!1}))}updatePositionsOptimized(){const e=this.config.performance.batchSize;if(this.nodeSelection){const t=this.nodeSelection.data();for(let s=0;s<t.length;s+=e)t.slice(s,s+e),this.nodeSelection.filter((t,i)=>i>=s&&i<s+e).attr("transform",e=>`translate(${e.x||0},${e.y||0})`)}this.edgeSelection&&this.updateEdgePositionsLOD()}updateEdgePositionsLOD(){const e=this.transform.k;this.config.performance.enableLOD?e<.5?this.edgeSelection.filter(e=>"CONTAINS"===e.type||"CONNECTED_TO"===e.type).select(".edge-line").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y):(this.edgeSelection.select(".edge-line").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),this.edgeSelection.select(".edge-bg").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),e>1.5?this.edgeSelection.select(".edge-label-group").style("opacity",1).attr("transform",e=>`translate(${(e.source.x+e.target.x)/2},${(e.source.y+e.target.y)/2}) rotate(${180*Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x)/Math.PI})`):this.edgeSelection.select(".edge-label-group").style("opacity",0)):this.updatePositions()}updateFPS(){this.performanceStats.frameCount++;const e=performance.now();e-this.performanceStats.lastFpsUpdate>1e3&&(this.performanceStats.fps=Math.round(1e3*this.performanceStats.frameCount/(e-this.performanceStats.lastFpsUpdate)),this.performanceStats.frameCount=0,this.performanceStats.lastFpsUpdate=e,this.simulationIterationCount)}adjustElementsForZoom(e){this.currentZoomLevel=e,this.config.performance.enableLOD&&(this.nodeSelection&&(e<.3?(this.nodeSelection.select(".node-label-group").style("opacity",0),this.nodeSelection.select(".degree-indicator").style("opacity",0),this.nodeSelection.select(".cluster-badge").style("opacity",0)):e<.8?(this.nodeSelection.select(".node-label-group").style("opacity",.7),this.nodeSelection.select(".degree-indicator").style("opacity",0),this.nodeSelection.select(".cluster-badge").style("opacity",e=>this.clusteredNodes.has(e.id)?.8:0)):(this.nodeSelection.select(".node-label-group").style("opacity",1),this.nodeSelection.select(".degree-indicator").style("opacity",.8),this.nodeSelection.select(".cluster-badge").style("opacity",e=>this.clusteredNodes.has(e.id)?1:0))),this.edgeSelection&&(e<.5?this.edgeSelection.select(".edge-bg").style("opacity",0):this.edgeSelection.select(".edge-bg").style("opacity",.3)))}scheduleRender(e){this.pendingRender||(this.pendingRender=!0,requestAnimationFrame(()=>{e(),this.pendingRender=!1}))}updateVisualizationOptimized(){performance.now();this.nodes.length,this.config.performance.maxVisibleNodes,this.scheduleRender(()=>{this.updateNodes(),this.updateEdges();performance.now()})}createDefinitions(){const e=this.svg.append("defs");Object.entries(this.config.nodeColors).forEach(([t,s])=>{const i=e.append("radialGradient").attr("id",`gradient-${t}`).attr("cx","30%").attr("cy","30%");i.append("stop").attr("offset","0%").attr("stop-color",this.d3.color(s).brighter(.5)),i.append("stop").attr("offset","100%").attr("stop-color",s)}),this.createArrowMarkers(e),this.createFilterEffects(e)}createArrowMarkers(e){e.append("marker").attr("id","arrowhead").attr("viewBox","-0 -5 10 10").attr("refX",18).attr("refY",0).attr("orient","auto").attr("markerWidth",8).attr("markerHeight",8).append("path").attr("d","M 0,-5 L 10,0 L 0,5").attr("fill","#7f8c8d"),e.append("marker").attr("id","arrowhead-highlight").attr("viewBox","-0 -5 10 10").attr("refX",18).attr("refY",0).attr("orient","auto").attr("markerWidth",10).attr("markerHeight",10).append("path").attr("d","M 0,-5 L 10,0 L 0,5").attr("fill","#f39c12"),e.append("marker").attr("id","arrowhead-large").attr("viewBox","-0 -6 12 12").attr("refX",20).attr("refY",0).attr("orient","auto").attr("markerWidth",10).attr("markerHeight",10).append("path").attr("d","M 0,-6 L 12,0 L 0,6").attr("fill","#e74c3c")}createFilterEffects(e){const t=e.append("filter").attr("id","drop-shadow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");t.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",2).attr("result","blur"),t.append("feOffset").attr("in","blur").attr("dx",2).attr("dy",2).attr("result","offsetBlur"),t.append("feFlood").attr("flood-color","#000000").attr("flood-opacity",.3),t.append("feComposite").attr("in2","offsetBlur").attr("operator","in");const s=t.append("feMerge");s.append("feMergeNode"),s.append("feMergeNode").attr("in","SourceGraphic");const i=e.append("filter").attr("id","glow").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");i.append("feGaussianBlur").attr("stdDeviation",4).attr("result","coloredBlur");const n=i.append("feMerge");n.append("feMergeNode").attr("in","coloredBlur"),n.append("feMergeNode").attr("in","SourceGraphic")}setupSubscriptions(){e.subscribe("nodes",e=>{this.nodes=[...e],this.updateVisualization()}),e.subscribe("edges",e=>{this.edges=[...e],this.updateVisualization()}),e.subscribe("selectedNode",e=>{this.handleNodeSelection(e)})}updateVisualization(){this.updateNodes(),this.updateEdges()}updateNodes(){if(!this.d3)return;const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id));this.nodeSelection=this.nodeGroup.selectAll(".node").data(e,e=>e.id),this.nodeSelection.exit().transition().duration(this.config.transitions.duration).delay((e,t)=>t*this.config.transitions.stagger).style("opacity",0).attr("transform",e=>`translate(${e.x||0},${e.y||0}) scale(0)`).remove();const t=this.nodeSelection.enter().append("g").attr("class","node").attr("transform",e=>`translate(${e.x||this.config.width/2},${e.y||this.config.height/2}) scale(0)`).style("opacity",0).call(this.setupDragBehavior()).call(this.setupNodeInteractions());this.createEnhancedNodeStructure(t),this.nodeSelection=t.merge(this.nodeSelection),t.transition().duration(this.config.transitions.duration).delay((e,t)=>t*this.config.transitions.stagger).style("opacity",1).attr("transform",e=>`translate(${e.x||this.config.width/2},${e.y||this.config.height/2}) scale(1)`),this.updateExistingNodes(),this.simulation.nodes(e),this.simulation.alpha(.3).restart()}createEnhancedNodeStructure(e){e.append("circle").attr("class","node-bg").attr("r",e=>this.getNodeRadius(e)+4).attr("fill","#ffffff").attr("fill-opacity",.4).attr("filter","url(#drop-shadow)"),e.append("circle").attr("class","node-circle").attr("r",e=>this.getNodeRadius(e)).attr("fill",e=>`url(#gradient-${e.type||"default"})`).attr("stroke","#2c3e50").attr("stroke-width",2.5).style("cursor","pointer"),e.append("text").attr("class","node-icon").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size",e=>`${Math.max(12,.8*this.getNodeRadius(e))}px`).style("fill","#ffffff").style("font-weight","bold").style("text-shadow","1px 1px 2px rgba(0,0,0,0.5)").style("pointer-events","none").style("user-select","none").text(e=>this.getNodeIcon(e.type));const t=e.append("g").attr("class","node-label-group").attr("transform",e=>`translate(0, ${this.getNodeRadius(e)+25})`);t.append("rect").attr("class","label-bg").attr("fill","rgba(255, 255, 255, 0.95)").attr("stroke","#bdc3c7").attr("stroke-width",1).attr("rx",4).attr("ry",4).style("filter","url(#drop-shadow)"),t.append("text").attr("class","node-label").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","11px").style("font-weight","bold").style("fill","#2c3e50").style("pointer-events","none").text(e=>this.truncateLabel(e.name||e.label||e.id,18)),t.selectAll(".label-bg").each(function(e){const t=d3.select(this.parentNode).select(".node-label").node().getBBox();d3.select(this).attr("x",t.x-4).attr("y",t.y-2).attr("width",t.width+8).attr("height",t.height+4)});const s=e.append("g").attr("class","cluster-badge").attr("transform",e=>`translate(${this.getNodeRadius(e)-8}, ${8-this.getNodeRadius(e)})`).style("opacity",e=>this.clusteredNodes.has(e.id)?1:0);s.append("circle").attr("r",8).attr("fill","#f39c12").attr("stroke","#e67e22").attr("stroke-width",2),s.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","10px").style("font-weight","bold").style("fill","#2c3e50").text(e=>this.getClusterSize(e.id));const i=e.append("g").attr("class","degree-indicator").attr("transform",e=>`translate(${8-this.getNodeRadius(e)}, ${8-this.getNodeRadius(e)})`);i.append("circle").attr("r",6).attr("fill","#3498db").attr("stroke","#2980b9").attr("stroke-width",1).style("opacity",.8),i.append("text").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","8px").style("font-weight","bold").style("fill","white").text(e=>this.getNodeDegree(e))}updateExistingNodes(){this.nodeSelection.select(".node-circle").transition().duration(this.config.transitions.duration/2).attr("r",e=>this.getNodeRadius(e)).attr("stroke",e=>this.selectedNodes.has(e.id)?"#f39c12":"#2c3e50").attr("stroke-width",e=>this.selectedNodes.has(e.id)?4:2.5).style("filter",e=>this.selectedNodes.has(e.id)?"url(#glow)":null),this.nodeSelection.select(".cluster-badge").transition().duration(this.config.transitions.duration/2).style("opacity",e=>this.clusteredNodes.has(e.id)?1:0),this.nodeSelection.select(".degree-indicator text").text(e=>this.getNodeDegree(e))}updateEdges(){if(!this.d3)return;const e=this.edges.filter(e=>{const t=!this.hiddenNodes.has(e.source.id||e.source),s=!this.hiddenNodes.has(e.target.id||e.target);return t&&s});this.edgeSelection=this.edgeGroup.selectAll(".edge").data(e,e=>e.id),this.edgeSelection.exit().transition().duration(this.config.transitions.duration).style("opacity",0).remove();const t=this.edgeSelection.enter().append("g").attr("class","edge").style("opacity",0).call(this.setupEdgeInteractions());this.createEdgeStructure(t),this.edgeSelection=t.merge(this.edgeSelection),t.transition().duration(this.config.transitions.duration).style("opacity",1),this.simulation.force("link").links(e),this.simulation.alpha(.3).restart()}createEdgeStructure(e){e.append("line").attr("class","edge-bg").attr("stroke","#ffffff").attr("stroke-width",e=>this.getEdgeWidth(e.type)+4).attr("stroke-opacity",.3),e.append("line").attr("class","edge-line").attr("stroke",e=>this.getEdgeColor(e.type)).attr("stroke-width",e=>this.getEdgeWidth(e.type)).attr("stroke-dasharray",e=>this.getEdgeDash(e.type)).attr("marker-end",e=>this.getMarkerEnd(e.type)).style("opacity",.8);const t=e.append("g").attr("class","edge-label-group").style("opacity",0);t.append("rect").attr("class","edge-label-bg").attr("fill","rgba(255, 255, 255, 0.95)").attr("stroke","#bdc3c7").attr("stroke-width",1).attr("rx",3),t.append("text").attr("class","edge-label").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","10px").style("font-weight","bold").style("fill","#2c3e50").style("pointer-events","none").text(e=>e.type||e.label||"")}setupDragBehavior(){return this.d3.drag().on("start",(e,t)=>{e.active||this.simulation.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y,this.isDragging=!0,this.d3.select(e.sourceEvent.target.parentNode).select(".node-circle").transition().attr("r",this.getNodeRadius(t)+5).style("filter","url(#glow)")}).on("drag",(e,t)=>{t.fx=e.x,t.fy=e.y}).on("end",(e,t)=>{e.active||this.simulation.alphaTarget(0),this.isDragging=!1,this.d3.select(e.sourceEvent.target.parentNode).select(".node-circle").transition().attr("r",this.getNodeRadius(t)).style("filter",this.selectedNodes.has(t.id)?"url(#glow)":null),e.active||(t.fx=null,t.fy=null)})}setupNodeInteractions(){return e=>{e.on("click",(e,t)=>{e.stopPropagation(),this.handleNodeClick(e,t)}).on("dblclick",(e,t)=>{e.stopPropagation(),this.handleNodeDoubleClick(e,t)}).on("mouseenter",(e,t)=>{this.handleNodeMouseEnter(e,t)}).on("mouseleave",(e,t)=>{this.handleNodeMouseLeave(e,t)}).on("contextmenu",(e,t)=>{e.preventDefault(),this.showContextMenu(e,t)})}}setupEdgeInteractions(){return e=>{e.on("click",(e,t)=>{e.stopPropagation(),this.handleEdgeClick(e,t)}).on("mouseenter",(e,t)=>{this.highlightEdge(t,!0)}).on("mouseleave",(e,t)=>{this.highlightEdge(t,!1)})}}handleNodeClick(t,s){this.selectedNodes.has(s.id)?t.ctrlKey||t.metaKey?(this.selectedNodes.delete(s.id),0===this.selectedNodes.size&&e.setState({selectedNode:null})):(this.selectedNodes.clear(),this.selectedNodes.add(s.id),e.setState({selectedNode:s})):(t.ctrlKey||t.metaKey||this.selectedNodes.clear(),this.selectedNodes.add(s.id),e.setState({selectedNode:s})),this.updateNodeSelection(),this.highlightConnectedElements(s.id)}handleNodeDoubleClick(e,t){if(this.clusteredNodes.has(t.id))this.expandCluster(t.id);else{const e=this.getNodeNeighbors(t.id);e.length>=this.config.clustering.minClusterSize?this.createCluster(t.id,e):this.focusOnNode(t.id)}}handleNodeMouseEnter(e,t){this.showEnhancedTooltip(e,t),this.highlightNodeNeighborhood(t.id,!0)}handleNodeMouseLeave(e,t){this.hideEnhancedTooltip(),this.selectedNodes.has(t.id)||this.highlightNodeNeighborhood(t.id,!1)}updatePositions(){this.nodeSelection&&this.nodeSelection.attr("transform",e=>`translate(${e.x},${e.y})`),this.edgeSelection&&(this.edgeSelection.select(".edge-line").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),this.edgeSelection.select(".edge-bg").attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),this.edgeSelection.select(".edge-label-group").attr("transform",e=>`translate(${(e.source.x+e.target.x)/2},${(e.source.y+e.target.y)/2}) rotate(${180*Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x)/Math.PI})`))}getNodeRadius(e){const t=this.getNodeDegree(e);return this.clusteredNodes.has(e.id)?this.config.nodeRadius.cluster:t>8?this.config.nodeRadius.large:t<3?this.config.nodeRadius.small:this.config.nodeRadius.medium}getNodeColor(e){return this.config.nodeColors[e]||this.config.nodeColors.default}getNodeIcon(e){return this.config.nodeIcons[e]||this.config.nodeIcons.default}getNodeDegree(e){return this.edges.filter(t=>t.source===e.id||t.target===e.id||t.source.id===e.id||t.target.id===e.id).length}getEdgeColor(e){return this.config.edgeTypes[e]?.color||this.config.edgeTypes.default.color}getEdgeWidth(e){return this.config.edgeTypes[e]?.width||this.config.edgeTypes.default.width}getEdgeDash(e){return this.config.edgeTypes[e]?.dash}getLinkDistance(e){const t=this.config.edgeTypes[e.type]||this.config.edgeTypes.default;return this.config.edgeLength[t.distance]||this.config.edgeLength.default}getMarkerEnd(e){return"CONTAINS"===e?"url(#arrowhead-large)":"url(#arrowhead)"}getClusterSize(e){const t=this.clusteredNodes.get(e);return t?t.length:0}truncateLabel(e,t=20){return e&&e.length>t?e.substring(0,t)+"...":e}showEnhancedTooltip(e,t){this.d3.selectAll(".enhanced-tooltip").remove();const s=this.d3.select("body").append("div").attr("class","enhanced-tooltip").style("position","absolute").style("background","linear-gradient(135deg, rgba(44,62,80,0.95), rgba(52,73,94,0.95))").style("color","white").style("padding","15px").style("border-radius","10px").style("font-size","13px").style("font-family","system-ui, -apple-system, sans-serif").style("pointer-events","none").style("z-index","3000").style("box-shadow","0 8px 25px rgba(0,0,0,0.3)").style("border","1px solid rgba(255,255,255,0.1)").style("max-width","350px").style("backdrop-filter","blur(5px)").style("opacity",0),i=this.getNodeDegree(t),n=this.clusteredNodes.has(t.id),a=n?this.getClusterSize(t.id):0;s.html(`\n            <div style="display: flex; align-items: center; margin-bottom: 10px;">\n                <span style="font-size: 24px; margin-right: 10px;">${this.getNodeIcon(t.type)}</span>\n                <div>\n                    <div style="font-weight: bold; font-size: 16px;">${t.name||t.label||t.id}</div>\n                    <div style="font-size: 11px; opacity: 0.8;">${t.type||"Unknown Type"}</div>\n                </div>\n            </div>\n            <div style="margin-bottom: 8px;"><strong>ID:</strong> ${t.id}</div>\n            <div style="margin-bottom: 8px;"><strong>Connections:</strong> ${i}</div>\n            ${t.address?.city?`<div style="margin-bottom: 8px;"><strong>Location:</strong> ${t.address.city}, ${t.address.state}</div>`:""}\n            ${n?`<div style="margin-bottom: 8px; color: #f39c12;"><strong>üìÅ Cluster:</strong> ${a} hidden nodes</div>`:""}\n            <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); font-size: 11px; opacity: 0.7;">\n                Click to select ‚Ä¢ Double-click to ${n?"expand":"cluster"} ‚Ä¢ Right-click for options\n            </div>\n        `);const o=s.node().getBoundingClientRect(),r=window.innerWidth,d=window.innerHeight;let c=e.pageX+15,l=e.pageY-10;c+o.width>r&&(c=e.pageX-o.width-15),l+o.height>d&&(l=e.pageY-o.height+10),s.style("left",c+"px").style("top",l+"px").transition().duration(200).style("opacity",1)}hideEnhancedTooltip(){this.d3.selectAll(".enhanced-tooltip").transition().duration(200).style("opacity",0).remove()}getNodeNeighbors(e,t=1){const s=new Set,i=new Set,n=[{id:e,currentDepth:0}];for(;n.length>0;){const{id:a,currentDepth:o}=n.shift();i.has(a)||o>t||(i.add(a),this.edges.forEach(r=>{let d=null;r.source.id===a||r.source===a?d=r.target.id||r.target:r.target.id!==a&&r.target!==a||(d=r.source.id||r.source),d&&!i.has(d)&&d!==e&&(s.add(d),o<t&&n.push({id:d,currentDepth:o+1}))}))}return Array.from(s)}resetView(){this.svg.transition().duration(1e3).call(this.zoom.transform,this.d3.zoomIdentity)}fitToView(){if(0===this.nodes.length)return;const e=this.getGraphBounds(),t=this.config.width,s=this.config.height,i=.8*Math.min(t/e.width,s/e.height),n=t/2-i*(e.x+e.width/2),a=s/2-i*(e.y+e.height/2);this.svg.transition().duration(1e3).call(this.zoom.transform,this.d3.zoomIdentity.translate(n,a).scale(i))}getGraphBounds(){const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id));if(0===e.length)return{x:0,y:0,width:1,height:1};const t=e.map(e=>e.x||0),s=e.map(e=>e.y||0);return{x:Math.min(...t)-50,y:Math.min(...s)-50,width:Math.max(...t)-Math.min(...t)+100,height:Math.max(...s)-Math.min(...s)+100}}setupAccessibilityFeatures(){this.setupGraphKeyboardNavigation(),this.addScreenReaderSupport(),this.setupFocusManagement(),this.createAccessibilityDescriptions()}setupGraphKeyboardNavigation(){this.container&&(this.container.setAttribute("tabindex","0"),this.container.setAttribute("role","application"),this.container.setAttribute("aria-label","Interactive knowledge graph"),this.container.addEventListener("keydown",e=>{this.handleGraphKeyboard(e)}),this.container.addEventListener("focus",()=>{this.announceGraphFocus()}))}handleGraphKeyboard(e){if(!this.nodes||0===this.nodes.length)return;if(0!==this.nodes.filter(e=>!this.hiddenNodes.has(e.id)).length)switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),this.navigateToNextNode();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),this.navigateToPreviousNode();break;case"Enter":case" ":e.preventDefault(),this.selectFocusedNode();break;case"Escape":e.preventDefault(),this.clearSelection(),this.container.blur();break;case"Tab":break;case"+":case"=":e.preventDefault(),this.zoomIn();break;case"-":e.preventDefault(),this.zoomOut();break;case"0":e.preventDefault(),this.resetView();break;case"f":case"F":e.preventDefault(),this.fitToView()}}navigateToNextNode(){const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id));if(0===e.length)return;this.focusedNodeIndex=(this.focusedNodeIndex+1)%e.length;const t=e[this.focusedNodeIndex];this.focusOnNode(t.id),this.announceNodeFocus(t)}navigateToPreviousNode(){const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id));if(0===e.length)return;this.focusedNodeIndex=this.focusedNodeIndex<=0?e.length-1:this.focusedNodeIndex-1;const t=e[this.focusedNodeIndex];this.focusOnNode(t.id),this.announceNodeFocus(t)}selectFocusedNode(){const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id));if(0===e.length||this.focusedNodeIndex<0)return;const t=e[this.focusedNodeIndex];this.handleNodeClick({ctrlKey:!1,metaKey:!1},t)}clearSelection(){this.selectedNodes.clear(),this.updateNodeSelection(),e.setState({selectedNode:null}),this.announceToScreenReader("Selection cleared")}focusOnNode(e){const t=this.nodes.find(t=>t.id===e);if(!t||this.hiddenNodes.has(e))return;const s=this.d3.zoomIdentity.translate(this.config.width/2-t.x*this.transform.k,this.config.height/2-t.y*this.transform.k).scale(Math.max(1,this.transform.k));this.svg.transition().duration(750).call(this.zoom.transform,s),this.highlightFocusedNode(e)}highlightFocusedNode(e){this.nodeSelection.select(".focus-ring").remove();const t=this.nodeSelection.filter(t=>t.id===e);t.insert("circle",".node-circle").attr("class","focus-ring").attr("r",e=>this.getNodeRadius(e)+8).attr("fill","none").attr("stroke","#ff6b35").attr("stroke-width",3).attr("stroke-dasharray","5,5").style("opacity",0).transition().duration(300).style("opacity",.8);const s=()=>{t.select(".focus-ring").transition().duration(1e3).attr("stroke-dashoffset",-10).on("end",s)};s()}addScreenReaderSupport(){const e=document.createElement("div");e.id="graph-description",e.className="sr-only",e.innerHTML="\n            This is an interactive knowledge graph visualization.\n            Use arrow keys to navigate between nodes.\n            Press Enter or Space to select a node.\n            Press Escape to clear selections and exit graph navigation.\n            Use + and - keys to zoom in and out.\n            Press F to fit all nodes to view.\n            Press 0 to reset the view.\n        ",document.body.appendChild(e),this.container.setAttribute("aria-describedby","graph-description")}setupFocusManagement(){this.container.addEventListener("focus",()=>{this.keyboardNavigationMode=!0,this.container.classList.add("keyboard-focused")}),this.container.addEventListener("blur",()=>{this.keyboardNavigationMode=!1,this.container.classList.remove("keyboard-focused"),this.nodeSelection&&this.nodeSelection.selectAll(".focus-ring").transition().duration(300).style("opacity",0).remove()}),this.container.addEventListener("nodeDataChanged",()=>{this.focusedNodeIndex=-1})}createAccessibilityDescriptions(){this.nodes.forEach(e=>{const t=this.getNodeDegree(e),s=`${e.type||"Node"} named ${e.name||e.id}. Has ${t} connection${1!==t?"s":""}. `+(e.address?.city?`Located in ${e.address.city}, ${e.address.state}. `:"")+(this.clusteredNodes.has(e.id)?`This is a cluster containing ${this.getClusterSize(e.id)} nodes. `:"");this.nodeDescriptions.set(e.id,s)})}announceGraphFocus(){const e=this.nodes.filter(e=>!this.hiddenNodes.has(e.id)).length,t=this.edges.length;this.announceToScreenReader(`Graph focused. Contains ${e} nodes and ${t} connections. Use arrow keys to navigate, Enter to select, Escape to exit.`)}announceNodeFocus(e){const t=this.nodeDescriptions.get(e.id)||`Node ${e.name||e.id}`;this.announceToScreenReader(`Focused on: ${t}`)}announceToScreenReader(e){if(window.dashboardUI&&window.dashboardUI.announceToScreenReader)return void window.dashboardUI.announceToScreenReader(e);const t=document.getElementById("sr-announcer");t&&(t.textContent=e,setTimeout(()=>{t.textContent=""},1e3))}zoomIn(){const e=Math.min(5,1.2*this.transform.k);this.svg.transition().duration(300).call(this.zoom.scaleBy,1.2),this.announceToScreenReader(`Zoomed in. Current zoom level: ${Math.round(100*e)}%`)}zoomOut(){const e=Math.max(.1,.8*this.transform.k);this.svg.transition().duration(300).call(this.zoom.scaleBy,.8),this.announceToScreenReader(`Zoomed out. Current zoom level: ${Math.round(100*e)}%`)}updateNodeSelection(){this.nodeSelection&&this.nodeSelection.each((e,t,s)=>{const i=this.d3.select(s[t]),n=i.select(".node-circle");this.selectedNodes.has(e.id)?(n.attr("stroke","#f39c12").attr("stroke-width",4).style("filter","url(#glow)"),i.attr("aria-selected","true")):(n.attr("stroke","#2c3e50").attr("stroke-width",2.5).style("filter",null),i.attr("aria-selected","false"))})}highlightNodeNeighborhood(e,t=!0){if(!this.nodeSelection||!this.edgeSelection)return;const s=new Set(this.getNodeNeighbors(e));if(s.add(e),this.nodeSelection.style("opacity",e=>t?s.has(e.id)?1:.3:1),this.edgeSelection.style("opacity",e=>{const i=e.source.id||e.source,n=e.target.id||e.target;return t?s.has(i)&&s.has(n)?1:.2:.8}),t){const e=s.size-1;this.announceToScreenReader(`Highlighting ${e} connected node${1!==e?"s":""}`)}}destroy(){this.simulation&&this.simulation.stop(),this.container&&(this.container.innerHTML=""),this.d3.selectAll(".enhanced-tooltip").remove(),this.hiddenNodes.clear(),this.clusteredNodes.clear(),this.selectedNodes.clear(),this.highlightedNodes.clear()}}class s{constructor(){this.currentTheme="theme-light",this.currentTab="details",this.legendVisible=!1,this.focusableElements=[],this.currentFocusIndex=-1,this.keyboardNavigationMode=!1,this.initializeEventListeners(),this.setupAccessibility(),this.setupKeyboardNavigation(),this.loadUserPreferences(),this.detectUserPreferences()}initializeEventListeners(){const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",()=>this.toggleTheme());const t=document.getElementById("layout-toggle");t&&t.addEventListener("click",()=>this.toggleLayout());const s=document.getElementById("legend-toggle");s&&s.addEventListener("click",()=>this.toggleLegend());const i=document.getElementById("details-tab"),n=document.getElementById("analysis-tab");i&&i.addEventListener("click",()=>this.switchTab("details")),n&&n.addEventListener("click",()=>this.switchTab("analysis"));const a=document.getElementById("search-input"),o=document.getElementById("search-clear");a&&(a.addEventListener("input",e=>this.handleSearch(e.target.value)),a.addEventListener("keydown",e=>{"Escape"===e.key&&this.clearSearch()})),o&&o.addEventListener("click",()=>this.clearSearch()),this.setupFilterListeners(),this.setupGraphControlListeners(),document.addEventListener("keydown",e=>this.handleKeyboardNavigation(e)),document.addEventListener("focusin",e=>this.handleFocusIn(e)),document.addEventListener("focusout",e=>this.handleFocusOut(e)),document.addEventListener("mousedown",()=>this.keyboardNavigationMode=!1),document.addEventListener("touchstart",()=>this.keyboardNavigationMode=!1),window.addEventListener("resize",()=>this.handleResize())}setupAccessibility(){this.setupScreenReaderSupport(),this.updateAriaLabels(),this.updateFocusableElements(),this.enhanceLandmarks(),this.setupContrastListener()}toggleTheme(){const e=document.getElementById("app"),t=document.getElementById("theme-toggle");if(e&&t){switch(this.currentTheme){case"theme-light":this.currentTheme="theme-dark",t.innerHTML='<span aria-hidden="true">‚òÄÔ∏è</span> Light',t.setAttribute("aria-label","Switch to light mode");break;case"theme-dark":this.currentTheme="theme-high-contrast",t.innerHTML='<span aria-hidden="true">‚ö™</span> Contrast',t.setAttribute("aria-label","Switch to high contrast mode");break;case"theme-high-contrast":this.currentTheme="theme-light",t.innerHTML='<span aria-hidden="true">üåô</span> Dark',t.setAttribute("aria-label","Switch to dark mode")}e.className=this.currentTheme,this.saveUserPreference("theme",this.currentTheme),this.announceToScreenReader(`Switched to ${this.currentTheme.replace("theme-","")} theme`)}}toggleLayout(){const e=["Force-Directed","Circular","Hierarchical","Grid"],t=e.findIndex(e=>document.getElementById("layout-toggle").textContent.includes(e)),s=e[(t+1)%e.length];document.getElementById("layout-toggle").innerHTML=`<span aria-hidden="true">üîÄ</span> ${s}`,document.dispatchEvent(new CustomEvent("layoutChange",{detail:{layout:s.toLowerCase().replace("-","")}})),this.announceToScreenReader(`Layout changed to ${s}`)}toggleLegend(){const e=document.getElementById("legend"),t=document.getElementById("legend-toggle");e&&t&&(this.legendVisible=!this.legendVisible,this.legendVisible?(e.classList.remove("hidden"),t.setAttribute("aria-pressed","true"),this.announceToScreenReader("Legend shown")):(e.classList.add("hidden"),t.setAttribute("aria-pressed","false"),this.announceToScreenReader("Legend hidden")),this.saveUserPreference("legendVisible",this.legendVisible))}switchTab(e){["details","analysis"].forEach(t=>{const s=document.getElementById(`${t}-tab`),i=document.getElementById(`${t}-content`);s&&i&&(t===e?(s.classList.add("active"),s.setAttribute("aria-selected","true"),s.setAttribute("tabindex","0"),i.classList.add("active")):(s.classList.remove("active"),s.setAttribute("aria-selected","false"),s.setAttribute("tabindex","-1"),i.classList.remove("active")))}),this.currentTab=e,this.announceToScreenReader(`Switched to ${e} tab`)}handleSearch(e){const t=document.getElementById("search-clear");t&&(t.style.display=e?"block":"none"),document.dispatchEvent(new CustomEvent("searchGraph",{detail:{query:e.trim()}})),e.trim()&&this.announceToScreenReader(`Searching for "${e}"`)}clearSearch(){const e=document.getElementById("search-input"),t=document.getElementById("search-clear");e&&(e.value="",e.focus()),t&&(t.style.display="none"),document.dispatchEvent(new CustomEvent("searchGraph",{detail:{query:""}})),this.announceToScreenReader("Search cleared")}setupFilterListeners(){["filter-files","filter-folders","filter-tags"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("change",()=>this.handleFilterChange())});["filter-strong","filter-weak"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("change",()=>this.handleFilterChange())});["node-size-slider","link-strength-slider"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("input",()=>this.handleRangeChange(e,t.value))});const e=document.getElementById("reset-filters");e&&e.addEventListener("click",()=>this.resetFilters())}setupGraphControlListeners(){["reset-view","fit-view","expand-all","collapse-all"].forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("graphControl",{detail:{action:e.replace("-","")}})),this.announceToScreenReader(`${e.replace("-"," ")} activated`)})})}handleFilterChange(){const e=this.collectFilterState();document.dispatchEvent(new CustomEvent("filtersChanged",{detail:e})),this.saveUserPreference("filters",e)}handleRangeChange(e,t){const s=e.replace("-slider","");document.dispatchEvent(new CustomEvent("rangeChanged",{detail:{type:s,value:parseFloat(t)}}))}collectFilterState(){return{nodeTypes:{files:document.getElementById("filter-files")?.checked||!1,folders:document.getElementById("filter-folders")?.checked||!1,tags:document.getElementById("filter-tags")?.checked||!1},connections:{strong:document.getElementById("filter-strong")?.checked||!1,weak:document.getElementById("filter-weak")?.checked||!1},ranges:{nodeSize:parseFloat(document.getElementById("node-size-slider")?.value||1),linkStrength:parseFloat(document.getElementById("link-strength-slider")?.value||1)}}}resetFilters(){["filter-files","filter-folders","filter-tags","filter-strong","filter-weak"].forEach(e=>{const t=document.getElementById(e);t&&(t.checked=!0)});const e=document.getElementById("node-size-slider"),t=document.getElementById("link-strength-slider");e&&(e.value=1),t&&(t.value=1),this.handleFilterChange(),this.announceToScreenReader("Filters reset to default")}handleKeyboardNavigation(e){if(["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Space"].includes(e.key)&&(this.keyboardNavigationMode=!0),"Escape"!==e.key)return"Enter"!==e.key&&" "!==e.key||"button"!==e.target.getAttribute("role")?void("Tab"!==e.key?(this.handleArrowNavigation(e),this.handleKeyboardShortcuts(e)):this.handleTabNavigation(e)):(e.preventDefault(),void e.target.click());this.handleEscapeKey(e)}handleResize(){document.dispatchEvent(new CustomEvent("dashboardResize"))}setupKeyboardNavigation(){this.navigationMap={header:{selector:".header-toolbar button, .header-toolbar input",direction:"horizontal"},filters:{selector:".sidebar-filters input, .sidebar-filters button",direction:"vertical"},"graph-controls":{selector:".graph-controls-overlay button",direction:"vertical"},tabs:{selector:".panel-tabs .tab-button",direction:"horizontal"}},this.setupRovingTabindex()}setupRovingTabindex(){Object.keys(this.navigationMap).forEach(e=>{const t=this.navigationMap[e],s=document.querySelectorAll(t.selector);0!==s.length&&s.forEach((t,s)=>{t.setAttribute("tabindex",0===s?"0":"-1"),t.dataset.navigationGroup=e,t.dataset.navigationIndex=s})})}updateFocusableElements(){this.focusableElements=Array.from(document.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])')).filter(e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&null!==e.offsetParent})}handleEscapeKey(e){if(this.legendVisible)return void this.toggleLegend();if("search-input"===e.target.id)return void this.clearSearch();const t=document.getElementById("main-content");t&&t.focus()}handleTabNavigation(e){if(this.updateFocusableElements(),0===this.focusableElements.length)return;const t=this.focusableElements.indexOf(e.target);let s;s=e.shiftKey?t<=0?this.focusableElements.length-1:t-1:t>=this.focusableElements.length-1?0:t+1,(0===t&&e.shiftKey||t===this.focusableElements.length-1&&!e.shiftKey)&&(e.preventDefault(),this.focusableElements[s].focus())}handleArrowNavigation(e){const t=e.target,s=t.dataset.navigationGroup;if(!s)return;const i=this.navigationMap[s];if(!i)return;const n=Array.from(document.querySelectorAll(i.selector)),a=n.indexOf(t);if(-1===a)return;let o=a;if("horizontal"===i.direction?"ArrowLeft"===e.key?(o=a>0?a-1:n.length-1,e.preventDefault()):"ArrowRight"===e.key&&(o=a<n.length-1?a+1:0,e.preventDefault()):"vertical"===i.direction&&("ArrowUp"===e.key?(o=a>0?a-1:n.length-1,e.preventDefault()):"ArrowDown"===e.key&&(o=a<n.length-1?a+1:0,e.preventDefault())),o!==a){if(n[a].setAttribute("tabindex","-1"),n[o].setAttribute("tabindex","0"),n[o].focus(),"tabs"===s){const e=n[o].id.replace("-tab","");this.switchTab(e)}this.announceToScreenReader(`Navigated to ${n[o].textContent||n[o].getAttribute("aria-label")}`)}}handleKeyboardShortcuts(e){if(!["input","textarea","select"].includes(e.target.tagName.toLowerCase())){if(e.ctrlKey||e.metaKey)switch(e.key){case"f":e.preventDefault(),document.getElementById("search-input")?.focus(),this.announceToScreenReader("Search focused");break;case"r":e.preventDefault(),this.resetFilters()}if(!e.ctrlKey&&!e.metaKey&&!e.altKey)switch(e.key){case"t":case"T":this.toggleTheme();break;case"l":case"L":this.toggleLegend();break;case"?":this.showKeyboardHelp()}}}handleFocusIn(e){if(this.keyboardNavigationMode&&e.target.classList.add("keyboard-focused"),e.target.getAttribute("aria-describedby")){const t=e.target.getAttribute("aria-describedby"),s=document.getElementById(t);s&&this.announceToScreenReader(s.textContent)}}handleFocusOut(e){e.target.classList.remove("keyboard-focused")}enhanceLandmarks(){if(!document.getElementById("sr-announcer")){const e=document.createElement("div");e.id="sr-announcer",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e)}const e=document.getElementById("graph-container");e&&(e.setAttribute("role","application"),e.setAttribute("aria-label","Interactive knowledge graph. Use arrow keys to navigate, Enter to select."),e.setAttribute("tabindex","0"))}updateAriaLabels(){}setupScreenReaderSupport(){document.getElementById("sr-announcer")||this.enhanceLandmarks(),this.addContextualHelp(),this.setupContentObserver()}addContextualHelp(){const e=document.getElementById("graph-container");e&&e.addEventListener("focus",()=>{this.announceToScreenReader("Graph focused. Use arrow keys to navigate nodes, Enter to select, Escape to return to main navigation.")});document.querySelectorAll(".filter-item input").forEach(e=>{e.addEventListener("focus",()=>{const t=e.closest("label");if(t){const e=t.textContent.replace(/\s+/g," ").trim();this.announceToScreenReader(`${e} filter`)}})})}setupContentObserver(){if("undefined"==typeof MutationObserver)return;const e=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&(this.updateFocusableElements(),(e.target.classList.contains("graph-controls-overlay")||e.target.classList.contains("panel-tabs"))&&this.setupRovingTabindex()),"node-details"===e.target.id&&"childList"===e.type&&this.announceNodeDetailsChange()})});e.observe(document.body,{childList:!0,subtree:!0,attributes:!1}),this.contentObserver=e}announceToScreenReader(e,t="polite"){const s=document.getElementById("sr-announcer");s&&(s.setAttribute("aria-live",t),s.textContent="",setTimeout(()=>{s.textContent=e;const t=Math.max(1e3,50*e.length);setTimeout(()=>{s.textContent===e&&(s.textContent="")},t)},50))}announceNodeDetailsChange(){const e=document.getElementById("node-details");if(!e)return;if(!e.querySelector(".no-selection")){const t=e.querySelector(".node-title");t&&this.announceToScreenReader(`Node selected: ${t.textContent}`)}else this.announceToScreenReader("No node selected")}showKeyboardHelp(){const e="\n            Keyboard shortcuts:\n            Tab: Navigate between controls\n            Arrow keys: Navigate within groups\n            Enter/Space: Activate buttons\n            Escape: Close overlays or clear search\n            T: Toggle theme\n            L: Toggle legend\n            Ctrl+F: Focus search\n            Ctrl+R: Reset filters\n            ?: Show this help\n        ".replace(/\n\s+/g,"\n").trim();this.announceToScreenReader(e,"assertive")}detectUserPreferences(){window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.body.classList.add("reduced-motion"),window.matchMedia&&window.matchMedia("(prefers-contrast: high)").matches&&(this.currentTheme.includes("high-contrast")||(this.currentTheme="theme-high-contrast",document.getElementById("app").className=this.currentTheme,this.updateThemeButton(),this.announceToScreenReader("High contrast mode activated based on system preference"))),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"theme-light"===this.currentTheme&&(this.currentTheme="theme-dark",document.getElementById("app").className=this.currentTheme,this.updateThemeButton())}setupContrastListener(){if(!window.matchMedia)return;const e=window.matchMedia("(prefers-contrast: high)"),t=window.matchMedia("(prefers-color-scheme: dark)");e.addEventListener("change",e=>{e.matches&&!this.currentTheme.includes("high-contrast")&&(this.currentTheme="theme-high-contrast",document.getElementById("app").className=this.currentTheme,this.updateThemeButton(),this.announceToScreenReader("High contrast mode activated"))}),t.addEventListener("change",e=>{localStorage.getItem("nas-graph-preferences")||(this.currentTheme=e.matches?"theme-dark":"theme-light",document.getElementById("app").className=this.currentTheme,this.updateThemeButton())})}saveUserPreference(e,t){try{const s=JSON.parse(localStorage.getItem("nas-graph-preferences")||"{}");s[e]=t,localStorage.setItem("nas-graph-preferences",JSON.stringify(s))}catch(s){}}loadUserPreferences(){try{const e=JSON.parse(localStorage.getItem("nas-graph-preferences")||"{}");e.theme&&e.theme!==this.currentTheme&&(this.currentTheme=e.theme,document.getElementById("app").className=this.currentTheme,this.updateThemeButton()),"boolean"==typeof e.legendVisible&&(this.legendVisible=!e.legendVisible,this.toggleLegend()),e.filters&&this.applyFilters(e.filters)}catch(e){}}updateThemeButton(){const e=document.getElementById("theme-toggle");if(e)switch(this.currentTheme){case"theme-light":e.innerHTML='<span aria-hidden="true">üåô</span> Dark',e.setAttribute("aria-label","Switch to dark mode");break;case"theme-dark":e.innerHTML='<span aria-hidden="true">‚ö™</span> Contrast',e.setAttribute("aria-label","Switch to high contrast mode");break;case"theme-high-contrast":e.innerHTML='<span aria-hidden="true">‚òÄÔ∏è</span> Light',e.setAttribute("aria-label","Switch to light mode")}}applyFilters(e){if(e.nodeTypes&&Object.entries(e.nodeTypes).forEach(([e,t])=>{const s=document.getElementById(`filter-${e}`);s&&(s.checked=t)}),e.connections&&Object.entries(e.connections).forEach(([e,t])=>{const s=document.getElementById(`filter-${e}`);s&&(s.checked=t)}),e.ranges){if(e.ranges.nodeSize){const t=document.getElementById("node-size-slider");t&&(t.value=e.ranges.nodeSize)}if(e.ranges.linkStrength){const t=document.getElementById("link-strength-slider");t&&(t.value=e.ranges.linkStrength)}}}updateGraphStats(e){const t={"nodes-count":e.nodeCount||0,"edges-count":e.edgeCount||0,"clusters-count":e.clusterCount||0,"density-value":`${(100*e.density||0).toFixed(1)}%`,"avg-degree-value":e.avgDegree?.toFixed(1)||0,"components-value":e.components||0};Object.entries(t).forEach(([e,t])=>{const s=document.getElementById(e);s&&(s.textContent=t)}),e.nodeCount!==this.lastStatsUpdate?.nodeCount&&this.announceToScreenReader(`Graph updated with ${e.nodeCount} nodes`),this.lastStatsUpdate=e}}document.addEventListener("DOMContentLoaded",()=>{window.dashboardUI=new s});export{t as D};
//# sourceMappingURL=chunk-VRMXnrWU.js.map
